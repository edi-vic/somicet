# Tables

## Profiles

### Schema

- id
- serial_number
- first_name
- last_name
- email
- is_admin
- misc
- created_at

```sql
create table
  public.profiles (
    id uuid not null,
    serial_number bigint generated by default as identity,
    first_name text null,
    last_name text null,
    email text not null,
    is_admin boolean not null default false,
    misc text null,
    created_at timestamp with time zone not null default now(),
    constraint profiles_pkey primary key (id),
    constraint profiles_serial_number_key unique (serial_number),
    constraint profiles_id_fkey foreign key (id) references auth.users (id)
  ) tablespace pg_default;
```

## Registrations

### Schema

- id
- serial_number
- name
- email
- secondment
- group
- receipt_url
- event
- status
- note
- misc
- created_at
- user_id

```sql
create table
  public.registrations (
    id uuid not null default gen_random_uuid (),
    serial_number bigint generated by default as identity,
    name text not null,
    email text not null,
    secondment text not null,
    group text not null,
    receipt_url text not null,
    event text not null default '23SIM1'::text,
    status text not null default 'pending'::text,
    note text null,
    misc text null,
    created_at timestamp with time zone not null default now(),
    user_id uuid not null default auth.uid (),
    constraint registrations_pkey primary key (id),
    constraint registrations_serial_number_key unique (serial_number),
    constraint registrations_user_id_fkey foreign key (user_id) references auth.users (id)
  ) tablespace pg_default;
```

### Policies

```sql
CREATE POLICY "allow users select own registration" ON "public"."registrations"
AS PERMISSIVE FOR SELECT
TO authenticated
USING (auth.uid() = user_id)
```

```sql
CREATE POLICY "allow admins select all registrations" ON "public"."registrations"
AS PERMISSIVE FOR SELECT
TO authenticated
USING (exists (select 1 from public.admins where admins.id = auth.uid()))
```

```sql
CREATE POLICY "allow users insert own registration" ON "public"."registrations"
AS PERMISSIVE FOR INSERT
TO authenticated
WITH CHECK (auth.uid() = user_id)
```

```sql
CREATE POLICY "allow users update own registration" ON "public"."registrations"
AS PERMISSIVE FOR UPDATE
TO authenticated
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id)
```

```sql
CREATE POLICY "allow admins update all registrations" ON "public"."registrations"
AS PERMISSIVE FOR UPDATE
TO authenticated
USING (exists (select 1 from public.admins where admins.id = auth.uid()))
WITH CHECK (exists (select 1 from public.admins where admins.id = auth.uid()))
```

## Posters

### Schema

- id
- serial_number
- title
- authors
- theme
- secondment
- summary
- acknowledgements
- status
- approval_number
- presentation_date
- presentation_time
- misc
- created_at
- user_id
- registration_id

```sql
create table
  public.posters (
    id uuid not null default gen_random_uuid (),
    serial_number bigint generated by default as identity,
    title text not null,
    authors text not null,
    theme text not null,
    secondment text not null,
    summary text not null,
    acknowledgements text not null,
    status text not null default 'pending'::text,
    approval_number bigint null,
    presentation_date date null,
    presentation_time time without time zone null,
    misc text null,
    created_at timestamp with time zone not null default now(),
    user_id uuid not null,
    registration_id uuid not null,
    constraint projects_pkey primary key (id),
    constraint projects_serial_number_key unique (serial_number),
    constraint projects_user_id_key unique (user_id),
    constraint posters_registration_id_fkey foreign key (registration_id) references registrations (id),
    constraint posters_user_id_fkey foreign key (user_id) references auth.users (id)
  ) tablespace pg_default;
```

## Bills

### Schema

- id
- serial_number
- name
- denomination
- rfc
- address
- status
- misc
- created_at
- registration_id
- user_id

```sql
create table
  public.bills (
    id uuid not null default gen_random_uuid (),
    serial_number bigint generated by default as identity,
    name text not null,
    denomination text null,
    rfc text not null,
    address text not null,
    status text not null default 'pending'::text,
    misc text null,
    created_at timestamp with time zone not null default now(),
    registration_id uuid not null,
    user_id uuid not null,
    constraint bills_pkey primary key (id),
    constraint bills_registration_id_key unique (registration_id),
    constraint bills_serial_number_key unique (serial_number),
    constraint bills_registration_id_fkey foreign key (registration_id) references registrations (id),
    constraint bills_user_id_fkey foreign key (user_id) references auth.users (id)
  ) tablespace pg_default;
```

## Admins

### Schema

- id
- name
- created_at

```sql
create table
  public.admins (
    id uuid not null,
    name text null,
    created_at timestamp with time zone not null default now(),
    constraint admins_pkey primary key (id),
    constraint admins_id_fkey foreign key (id) references auth.users (id)
  ) tablespace pg_default;
```